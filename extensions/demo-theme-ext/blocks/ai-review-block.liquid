<div class="product-review-section" style="text-align: left; padding-top: 10px; background: {% if block.settings.revert_to_default %}#ffffff{% else %}{{ block.settings.background_color | default: '#ffffff' }}{% endif %};">
  {% assign review_config = product.metafields.productReview.configuration.value | parse_json %}
  
  {% assign should_display = false %}
  {% if request.design_mode %}
    {% assign should_display = true %}
  {% else %}
    {% if review_config and review_config.size > 0 %}
      {% assign should_display = true %}
    {% endif %}
  {% endif %}

  {% if should_display %}
    <div class="review-carousel" style="position: relative; max-width: 1200px; margin: 0 auto;">
      <!-- Review Content -->
      <div class="review-slider" style="overflow: hidden;">
        <div class="review-items" style="display: flex; transition: transform 0.3s ease;" id="reviewSlider">
          {% if request.design_mode %}
            <!-- Default data for Theme Editor -->
            <div class="review-item" style="flex: 0 0 100%; border-radius: 8px; margin: 10px auto; max-width: 700px; display: flex; flex-direction: column; justify-content: space-between;">
              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                <span style="font-size: 18px; color: {% if block.settings.revert_to_default %}#000000{% else %}{{ block.settings.icon_color | default: '#000000' }}{% endif %};">➤</span>
                <span style="font-size: 18px; font-weight: bold; color: {% if block.settings.revert_to_default %}#222{% else %}{{ block.settings.text_color | default: '#222' }}{% endif %};">Sample Title</span>
              </div>
              <div style="font-style: italic; font-size: 13px; line-height: 1.6; color: {% if block.settings.revert_to_default %}#333{% else %}{{ block.settings.text_color | default: '#333' }}{% endif %};">
                <p>"This is a sample review to preview in the Theme Editor."</p>
              </div>
              <div style="margin-top: 10px; border-top: 1px solid rgb(234, 234, 234); padding-top: 10px;">
                <div style="font-style: italic; font-size: 12px; line-height: 1.6; color: rgb(139, 139, 139);">
                  <p>AI-generated review based on product details from multiple sources.</p>
                </div>
              </div>
            </div>
            <div class="review-item" style="flex: 0 0 100%; border-radius: 8px; margin: 10px auto; max-width: 700px; padding: 10px; display: flex; flex-direction: column; justify-content: space-between;">
              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                <span style="font-size: 18px; color: {% if block.settings.revert_to_default %}#000000{% else %}{{ block.settings.icon_color | default: '#000000' }}{% endif %};">➤</span>
                <span style="font-size: 18px; font-weight: bold; color: {% if block.settings.revert_to_default %}#222{% else %}{{ block.settings.text_color | default: '#222' }}{% endif %};">Another Title</span>
              </div>
              <div style="font-style: italic; font-size: 13px; line-height: 1.6; color: {% if block.settings.revert_to_default %}#333{% else %}{{ block.settings.text_color | default: '#333' }}{% endif %};">
                <p>"Another sample review for preview purposes."</p>
              </div>
              <div style="margin-top: 10px; border-top: 1px solid rgb(234, 234, 234); padding-top: 10px;">
                <div style="font-style: italic; font-size: 12px; line-height: 1.6; color: rgb(139, 139, 139);">
                  <p>AI-generated review based on product details from multiple sources.</p>
                </div>
              </div>
            </div>
          {% else %}
            <!-- Real data for Storefront -->
            {% for review in review_config %}
              <div class="review-item" style="flex: 0 0 100%; border-radius: 8px; margin: 10px auto; max-width: 700px; padding: 10px; display: flex; flex-direction: column; justify-content: space-between;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                  <span style="font-size: 18px; color: {% if block.settings.revert_to_default %}#000000{% else %}{{ block.settings.icon_color | default: '#000000' }}{% endif %};">➤</span>
                  <span style="font-size: 18px; font-weight: bold; color: {% if block.settings.revert_to_default %}#222{% else %}{{ block.settings.text_color | default: '#222' }}{% endif %};">{{ review.title }}</span>
                </div>
                <div style="font-style: italic; font-size: 13px; line-height: 1.6; color: {% if block.settings.revert_to_default %}#333{% else %}{{ block.settings.text_color | default: '#333' }}{% endif %};">
                  <p>"{{ review.comment }}"</p>
                </div>
                <div style="margin-top: 10px; border-top: 1px solid rgb(234, 234, 234); padding-top: 10px;">
                  <div style="font-style: italic; font-size: 12px; line-height: 1.6; color: rgb(139, 139, 139);">
                    <p>{{ review.star }}</p>
                  </div>
                </div>
              </div>
            {% endfor %}
          {% endif %}
        </div>
      </div>

      <!-- Pagination Dots and Navigation -->
      <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 30px;">
        <button onclick="moveReviewSlider(-1)" style="background: none; border: none; font-size: 16px; cursor: pointer; color: {% if block.settings.revert_to_default %}#333{% else %}{{ block.settings.text_color | default: '#333' }}{% endif %};">‹</button>
        {% if request.design_mode %}
          <!-- Default dots for Theme Editor -->
          <div class="pagination-dot" style="width: 6px; height: 6px; border-radius: 50%; background: rgb(0, 0, 0); cursor: pointer;" onclick="setReviewIndex(0)"></div>
          <div class="pagination-dot" style="width: 6px; height: 6px; border-radius: 50%; background: rgb(221, 221, 221); cursor: pointer;" onclick="setReviewIndex(1)"></div>
        {% else %}
          <!-- Real dots for Storefront -->
          {% for review in review_config %}
            <div class="pagination-dot" style="width: 6px; height: 6px; border-radius: 50%; background: {% if forloop.index0 == 0 %}rgb(0, 0, 0){% else %}rgb(221, 221, 221){% endif %}; cursor: pointer;" onclick="setReviewIndex({{ forloop.index0 }})"></div>
          {% endfor %}
        {% endif %}
        <button onclick="moveReviewSlider(1)" style="background: none; border: none; font-size: 16px; cursor: pointer; color: {% if block.settings.revert_to_default %}#333{% else %}{{ block.settings.text_color | default: '#333' }}{% endif %};">›</button>
      </div>
    </div>

    <!-- JavaScript for Slider -->
    <script>
      let currentReviewIndex = 0;
      const reviewItems = document.querySelectorAll('.review-item');
      const dots = document.querySelectorAll('.pagination-dot');
      const totalReviews = reviewItems.length;

      function updateSlider() {
        const slider = document.getElementById('reviewSlider');
        slider.style.transform = `translateX(-${currentReviewIndex * 100}%)`;
        dots.forEach((dot, index) => {
          dot.style.background = index === currentReviewIndex ? 'rgb(0, 0, 0)' : 'rgb(221, 221, 221)';
        });
      }

      function moveReviewSlider(direction) {
        currentReviewIndex += direction;
        if (currentReviewIndex < 0) currentReviewIndex = totalReviews - 1;
        if (currentReviewIndex >= totalReviews) currentReviewIndex = 0;
        updateSlider();
      }

      function setReviewIndex(index) {
        currentReviewIndex = index;
        updateSlider();
      }

      // Initialize slider
      updateSlider();
    </script>
  {% endif %}

  <style>
    .review-carousel {
      position: relative;
    }
    .review-item {
      transition: all 0.3s ease;
    }
    .review-item p {
      margin: 0;
    }
    @media (max-width: 768px) {
      .product-review-section {
        padding: 15px 10px;
      }
      .review-item {
        max-width: 100%;
      }
      .review-item span[style*="font-size: 18px"] {
        font-size: 16px;
      }
      .review-item div[style*="font-size: 13px"] p {
        font-size: 12px;
      }
      .review-item div[style*="font-size: 12px"] p {
        font-size: 11px;
      }
      .pagination-dot {
        width: 5px;
        height: 5px;
      }
      button[onclick*="moveReviewSlider"] {
        font-size: 14px;
      }
    }
  </style>

  {% schema %}
  {
    "name": "AI Review Block",
    "target": "section",
    "settings": [
      {
        "type": "product",
        "id": "product",
        "label": "Select Product"
      },
      {
        "type": "color",
        "id": "text_color",
        "label": "Text Color",
        "default": "#333333"
      },
      {
        "type": "color",
        "id": "icon_color",
        "label": "Icon Color",
        "default": "#000000"
      },
      {
        "type": "color_background",
        "id": "background_color",
        "label": "Background Color",
        "default": "#ffffff"
      },
      {
        "type": "checkbox",
        "id": "revert_to_default",
        "label": "Revert to Default Settings",
        "default": false
      }
    ]
  }
  {% endschema %}
</div>