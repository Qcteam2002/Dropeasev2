<div class="product-review-section" style="max-width: 1200px; margin: 0 auto; text-align: left; background: {% if block.settings.revert_to_default %}#ffffff{% else %}{{ block.settings.background_color | default: '#ffffff' }}{% endif %};">
  {% assign review_config = product.metafields.productReview.configuration.value | parse_json %}
  
  {% assign should_display = false %}
  {% if request.design_mode %}
    {% assign should_display = true %}
  {% else %}
    {% if review_config.product_handle and review_config.product_handle == product.handle and review_config.reviews and review_config.reviews.size > 0 %}
      {% assign should_display = true %}
    {% endif %}
  {% endif %}

  {% if should_display %}
    <div class="review-carousel" style="position: relative;">
      <!-- Review Content -->
      <div class="review-slider" style="overflow: hidden;">
        <div class="review-items" style="display: flex; transition: transform 0.3s ease;" id="reviewSlider">
          {% if request.design_mode %}
            <!-- Default data for Theme Editor -->
            <div class="review-item" style="flex: 0 0 100%; margin: 0 auto; max-width: 600px; display: flex; flex-direction: column; justify-content: space-between;">
              <div style="font-family: {% if block.settings.revert_to_default %}Helvetica, Arial, sans-serif{% else %}{{ block.settings.font | default: 'Helvetica, Arial, sans-serif' }}{% endif %}; font-size: {% if block.settings.revert_to_default %}14{% else %}{{ block.settings.font_size | default: '14' }}{% endif %}px; line-height: 1.5; color: {% if block.settings.revert_to_default %}#333{% else %}{{ block.settings.text_color | default: '#333' }}{% endif %}; {% if block.settings.revert_to_default %}font-weight: normal; font-style: normal; text-decoration: none;{% else %}{% if block.settings.font_style == 'bold' %}font-weight: bold;{% elsif block.settings.font_style == 'italic' %}font-style: italic;{% elsif block.settings.font_style == 'underline' %}text-decoration: underline;{% endif %}{% endif %}">
                <p>"This is a sample review to preview in the Theme Editor."</p>
              </div>
              <div style="display: flex; align-items: center; margin-top: 8px; border-top: 1px solid #e1e1e1; padding-top: 8px;">
                <div style="display: flex; align-items: center; gap: 8px;">
                  <div style="font-family: {% if block.settings.revert_to_default %}Helvetica, Arial, sans-serif{% else %}{{ block.settings.font | default: 'Helvetica, Arial, sans-serif' }}{% endif %}; font-size: {% if block.settings.revert_to_default %}14{% else %}{{ block.settings.font_size | default: '14' }}{% endif %}px; color: {% if block.settings.revert_to_default %}#666{% else %}{{ block.settings.text_color | default: '#666' }}{% endif %}; {% if block.settings.revert_to_default %}font-weight: normal; font-style: normal; text-decoration: none;{% else %}{% if block.settings.font_style == 'bold' %}font-weight: bold;{% elsif block.settings.font_style == 'italic' %}font-style: italic;{% elsif block.settings.font_style == 'underline' %}text-decoration: underline;{% endif %}{% endif %}">
                    <p>Sample Reviewer</p>
                  </div>
                  <div style="display: flex; gap: 2px;">
                    <span style="color: {% if block.settings.revert_to_default %}#000{% else %}{{ block.settings.star_color | default: '#000' }}{% endif %}; font-size: {% if block.settings.revert_to_default %}14{% else %}{{ block.settings.font_size | default: '14' }}{% endif %}px;">★</span>
                    <span style="color: {% if block.settings.revert_to_default %}#000{% else %}{{ block.settings.star_color | default: '#000' }}{% endif %}; font-size: {% if block.settings.revert_to_default %}14{% else %}{{ block.settings.font_size | default: '14' }}{% endif %}px;">★</span>
                    <span style="color: {% if block.settings.revert_to_default %}#000{% else %}{{ block.settings.star_color | default: '#000' }}{% endif %}; font-size: {% if block.settings.revert_to_default %}14{% else %}{{ block.settings.font_size | default: '14' }}{% endif %}px;">★</span>
                    <span style="color: {% if block.settings.revert_to_default %}#000{% else %}{{ block.settings.star_color | default: '#000' }}{% endif %}; font-size: {% if block.settings.revert_to_default %}14{% else %}{{ block.settings.font_size | default: '14' }}{% endif %}px;">★</span>
                    <span style="color: {% if block.settings.revert_to_default %}#000{% else %}{{ block.settings.star_color | default: '#000' }}{% endif %}; font-size: {% if block.settings.revert_to_default %}14{% else %}{{ block.settings.font_size | default: '14' }}{% endif %}px;">☆</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="review-item" style="flex: 0 0 100%; margin: 0 auto; max-width: 600px; display: flex; flex-direction: column; justify-content: space-between;">
              <div style="font-family: {% if block.settings.revert_to_default %}Helvetica, Arial, sans-serif{% else %}{{ block.settings.font | default: 'Helvetica, Arial, sans-serif' }}{% endif %}; font-size: {% if block.settings.revert_to_default %}14{% else %}{{ block.settings.font_size | default: '14' }}{% endif %}px; line-height: 1.5; color: {% if block.settings.revert_to_default %}#333{% else %}{{ block.settings.text_color | default: '#333' }}{% endif %}; {% if block.settings.revert_to_default %}font-weight: normal; font-style: normal; text-decoration: none;{% else %}{% if block.settings.font_style == 'bold' %}font-weight: bold;{% elsif block.settings.font_style == 'italic' %}font-style: italic;{% elsif block.settings.font_style == 'underline' %}text-decoration: underline;{% endif %}{% endif %}">
                <p>"Another sample review for preview purposes."</p>
              </div>
              <div style="display: flex; align-items: center; margin-top: 8px; border-top: 1px solid #e1e1e1; padding-top: 8px;">
                <div style="display: flex; align-items: center; gap: 8px;">
                  <div style="font-family: {% if block.settings.revert_to_default %}Helvetica, Arial, sans-serif{% else %}{{ block.settings.font | default: 'Helvetica, Arial, sans-serif' }}{% endif %}; font-size: {% if block.settings.revert_to_default %}14{% else %}{{ block.settings.font_size | default: '14' }}{% endif %}px; color: {% if block.settings.revert_to_default %}#666{% else %}{{ block.settings.text_color | default: '#666' }}{% endif %}; {% if block.settings.revert_to_default %}font-weight: normal; font-style: normal; text-decoration: none;{% else %}{% if block.settings.font_style == 'bold' %}font-weight: bold;{% elsif block.settings.font_style == 'italic' %}font-style: italic;{% elsif block.settings.font_style == 'underline' %}text-decoration: underline;{% endif %}{% endif %}">
                    <p>Another Reviewer</p>
                  </div>
                  <div style="display: flex; gap: 2px;">
                    <span style="color: {% if block.settings.revert_to_default %}#000{% else %}{{ block.settings.star_color | default: '#000' }}{% endif %}; font-size: {% if block.settings.revert_to_default %}14{% else %}{{ block.settings.font_size | default: '14' }}{% endif %}px;">★</span>
                    <span style="color: {% if block.settings.revert_to_default %}#000{% else %}{{ block.settings.star_color | default: '#000' }}{% endif %}; font-size: {% if block.settings.revert_to_default %}14{% else %}{{ block.settings.font_size | default: '14' }}{% endif %}px;">★</span>
                    <span style="color: {% if block.settings.revert_to_default %}#000{% else %}{{ block.settings.star_color | default: '#000' }}{% endif %}; font-size: {% if block.settings.revert_to_default %}14{% else %}{{ block.settings.font_size | default: '14' }}{% endif %}px;">★</span>
                    <span style="color: {% if block.settings.revert_to_default %}#000{% else %}{{ block.settings.star_color | default: '#000' }}{% endif %}; font-size: {% if block.settings.revert_to_default %}14{% else %}{{ block.settings.font_size | default: '14' }}{% endif %}px;">☆</span>
                    <span style="color: {% if block.settings.revert_to_default %}#000{% else %}{{ block.settings.star_color | default: '#000' }}{% endif %}; font-size: {% if block.settings.revert_to_default %}14{% else %}{{ block.settings.font_size | default: '14' }}{% endif %}px;">☆</span>
                  </div>
                </div>
              </div>
            </div>
          {% else %}
            <!-- Real data for Storefront -->
            {% for review in review_config.reviews %}
              <div class="review-item" style="flex: 0 0 100%; margin: 0 auto; max-width: 600px; display: flex; flex-direction: column; justify-content: space-between;">
                <div style="font-family: {% if block.settings.revert_to_default %}Helvetica, Arial, sans-serif{% else %}{{ block.settings.font | default: 'Helvetica, Arial, sans-serif' }}{% endif %}; font-size: {% if block.settings.revert_to_default %}14{% else %}{{ block.settings.font_size | default: '14' }}{% endif %}px; line-height: 1.5; color: {% if block.settings.revert_to_default %}#333{% else %}{{ block.settings.text_color | default: '#333' }}{% endif %}; {% if block.settings.revert_to_default %}font-weight: normal; font-style: normal; text-decoration: none;{% else %}{% if block.settings.font_style == 'bold' %}font-weight: bold;{% elsif block.settings.font_style == 'italic' %}font-style: italic;{% elsif block.settings.font_style == 'underline' %}text-decoration: underline;{% endif %}{% endif %}">
                  <p>"{{ review.comment }}"</p>
                </div>
                <div style="display: flex; align-items: center; margin-top: 8px; border-top: 1px solid #e1e1e1; padding-top: 8px;">
                  <div style="display: flex; align-items: center; gap: 8px;">
                    <div style="font-family: {% if block.settings.revert_to_default %}Helvetica, Arial, sans-serif{% else %}{{ block.settings.font | default: 'Helvetica, Arial, sans-serif' }}{% endif %}; font-size: {% if block.settings.revert_to_default %}14{% else %}{{ block.settings.font_size | default: '14' }}{% endif %}px; color: {% if block.settings.revert_to_default %}#666{% else %}{{ block.settings.text_color | default: '#666' }}{% endif %}; {% if block.settings.revert_to_default %}font-weight: normal; font-style: normal; text-decoration: none;{% else %}{% if block.settings.font_style == 'bold' %}font-weight: bold;{% elsif block.settings.font_style == 'italic' %}font-style: italic;{% elsif block.settings.font_style == 'underline' %}text-decoration: underline;{% endif %}{% endif %}">
                      <p>{{ review.reviewer }}</p>
                    </div>
                    <div style="display: flex; gap: 2px;">
{% for i in (1..5) %}
  {% if i <= review.rating %}
    <span style="...">★</span>
  {% else %}
    <span style="...">☆</span>
  {% endif %}
{% endfor %}
                    </div>
                  </div>
                </div>
              </div>
            {% endfor %}
          {% endif %}
        </div>
      </div>

      <!-- Pagination Dots and Navigation -->
      <div style="display: flex; justify-content: center; align-items: center; gap: 8px; margin-top: 10px;">
        <button onclick="moveReviewSlider(-1)" style="background: none; border: none; font-size: {% if block.settings.revert_to_default %}16{% else %}{{ block.settings.font_size | default: '16' }}{% endif %}px; cursor: pointer; color: {% if block.settings.revert_to_default %}#333{% else %}{{ block.settings.text_color | default: '#333' }}{% endif %}; {% if block.settings.revert_to_default %}font-weight: normal; font-style: normal; text-decoration: none;{% else %}{% if block.settings.font_style == 'bold' %}font-weight: bold;{% elsif block.settings.font_style == 'italic' %}font-style: italic;{% elsif block.settings.font_style == 'underline' %}text-decoration: underline;{% endif %}{% endif %}">‹</button>
        {% if request.design_mode %}
          <!-- Default dots for Theme Editor -->
          <div class="pagination-dot" style="width: 8px; height: 8px; border-radius: 50%; background: {% if block.settings.revert_to_default %}#333{% else %}{{ block.settings.text_color | default: '#333' }}{% endif %}; cursor: pointer;" onclick="setReviewIndex(0)"></div>
          <div class="pagination-dot" style="width: 8px; height: 8px; border-radius: 50%; background: #ccc; cursor: pointer;" onclick="setReviewIndex(1)"></div>
        {% else %}
          <!-- Real dots for Storefront -->
          {% for review in review_config.reviews %}
            <div class="pagination-dot" style="width: 8px; height: 8px; border-radius: 50%; background: {% if forloop.index0 == 0 %}{% if block.settings.revert_to_default %}#333{% else %}{{ block.settings.text_color | default: '#333' }}{% endif %}{% else %}#ccc{% endif %}; cursor: pointer;" onclick="setReviewIndex({{ forloop.index0 }})"></div>
          {% endfor %}
        {% endif %}
        <button onclick="moveReviewSlider(1)" style="background: none; border: none; font-size: {% if block.settings.revert_to_default %}16{% else %}{{ block.settings.font_size | default: '16' }}{% endif %}px; cursor: pointer; color: {% if block.settings.revert_to_default %}#333{% else %}{{ block.settings.text_color | default: '#333' }}{% endif %}; {% if block.settings.revert_to_default %}font-weight: normal; font-style: normal; text-decoration: none;{% else %}{% if block.settings.font_style == 'bold' %}font-weight: bold;{% elsif block.settings.font_style == 'italic' %}font-style: italic;{% elsif block.settings.font_style == 'underline' %}text-decoration: underline;{% endif %}{% endif %}">›</button>
      </div>
    </div>

    <!-- JavaScript for Slider -->
    <script>
      let currentReviewIndex = 0;
      const reviewItems = document.querySelectorAll('.review-item');
      const dots = document.querySelectorAll('.pagination-dot');
      const totalReviews = reviewItems.length;

      function updateSlider() {
        const slider = document.getElementById('reviewSlider');
        slider.style.transform = `translateX(-${currentReviewIndex * 100}%)`;
        dots.forEach((dot, index) => {
          dot.style.background = index === currentReviewIndex ? '{% if block.settings.revert_to_default %}#333{% else %}{{ block.settings.text_color | default: "#333" }}{% endif %}' : '#ccc';
        });
      }

      function moveReviewSlider(direction) {
        currentReviewIndex += direction;
        if (currentReviewIndex < 0) currentReviewIndex = totalReviews - 1;
        if (currentReviewIndex >= totalReviews) currentReviewIndex = 0;
        updateSlider();
      }

      function setReviewIndex(index) {
        currentReviewIndex = index;
        updateSlider();
      }

      // Initialize slider
      updateSlider();
    </script>
  {% endif %}

  <style>
    .review-carousel {
      position: relative;
    }
    .review-item {
      transition: all 0.3s ease;
    }
    @media (max-width: 768px) {
      .product-review-section {
        padding: 15px 10px;
      }
      .review-item {
        max-width: 100%;
      }
      .review-item p {
        font-size: calc({% if block.settings.revert_to_default %}14{% else %}{{ block.settings.font_size | default: '14' }}{% endif %}px * 0.85);
      }
      .review-item div[style*="font-size"] p {
        font-size: calc({% if block.settings.revert_to_default %}14{% else %}{{ block.settings.font_size | default: '14' }}{% endif %}px * 0.85);
      }
      .review-item div[style*="display: flex"] span {
        font-size: calc({% if block.settings.revert_to_default %}14{% else %}{{ block.settings.font_size | default: '14' }}{% endif %}px * 0.85);
      }
      .pagination-dot {
        width: 6px;
        height: 6px;
      }
      button[onclick*="moveReviewSlider"] {
        font-size: calc({% if block.settings.revert_to_default %}16{% else %}{{ block.settings.font_size | default: '16' }}{% endif %}px * 0.875);
      }
    }
  </style>

  {% schema %}
  {
    "name": "Product Review Block",
    "target": "section",
    "settings": [
      {
        "type": "product",
        "id": "product",
        "label": "Select Product"
      },
      {
        "type": "select",
        "id": "font",
        "label": "Review Font",
        "options": [
          {
            "value": "Helvetica, Arial, sans-serif",
            "label": "Helvetica"
          },
          {
            "value": "Times New Roman, Times, serif",
            "label": "Times New Roman"
          },
          {
            "value": "Georgia, serif",
            "label": "Georgia"
          },
          {
            "value": "Arial, sans-serif",
            "label": "Arial"
          },
          {
            "value": "Verdana, sans-serif",
            "label": "Verdana"
          }
        ],
        "default": "Helvetica, Arial, sans-serif"
      },
      {
        "type": "range",
        "id": "font_size",
        "label": "Font Size",
        "min": 12,
        "max": 24,
        "step": 1,
        "unit": "px",
        "default": 14
      },
      {
        "type": "select",
        "id": "font_style",
        "label": "Font Style",
        "options": [
          {
            "value": "normal",
            "label": "Normal"
          },
          {
            "value": "bold",
            "label": "Bold"
          },
          {
            "value": "italic",
            "label": "Italic"
          },
          {
            "value": "underline",
            "label": "Underline"
          }
        ],
        "default": "normal"
      },
      {
        "type": "color",
        "id": "text_color",
        "label": "Text Color",
        "default": "#333333"
      },
      {
        "type": "color_background",
        "id": "background_color",
        "label": "Background Color",
        "default": "#ffffff"
      },
      {
        "type": "color",
        "id": "star_color",
        "label": "Star Color",
        "default": "#000000"
      },
      {
        "type": "checkbox",
        "id": "revert_to_default",
        "label": "Revert to Default Settings",
        "default": false
      }
    ]
  }
  {% endschema %}
</div>